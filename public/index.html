<!DOCTYPE html>

<html>

<head>

  <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script
      src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
  <script>
    $(function () {
      $.getJSON('/targets', function (targets) {
        _.each(_.keys(targets), function (name) {
          $('<button>' + name + '</button>').click(
              function () {
                $('#cmd').val(targets[name]);
                $('form').submit();
              }).appendTo('.targets');
        });
      });

      $('form').submit(function () {
        send($('#cmd').val(), 'execute');
        return false;
      });

      function send(cmd, url) {
        $.ajax({
          'type': 'POST',
          'url': url,
          'data': {
            'cmd': cmd
          }
        });
      }

      $('td > button').mousedown(
          function () {
            send(this.id, 'control');
          }).mouseup(function () {
            send('stop', 'control');
          });
    });
  </script>
</head>

<body>
<h2>Launcher Control</h2>

<div class="targets">
</div>

<table>
  <tr>
    <td></td>
    <td>
      <button id="up">▲</button>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>
      <button id="left">◀</button>
    </td>
    <td>
      <button id="fire">◎</button>
    </td>
    <td>
      <button id="right">▶</button>
    </td>
  </tr>

  <tr>
    <td></td>
    <td>
      <button id="down">▼</button>
    </td>
    <td></td>
  </tr>
</table>

<form>
  <details>
    <summary>Control Instructions</summary>
    <pre>
Define launch sequences here up(u), down(d), left(l), right(r), fire(f), reset(z)
The numbers after u,d,l,r represents ms to do that action.
The number after f represents number of missiles to fire
e.g. this is a valid sequence:  d1000,l200,r,u100,f2
  </pre>
  </details>

  <input type="text" id="cmd"/>
  <input type="submit" value="Execute!"/>
</form>

</body>

</html>
