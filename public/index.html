<!DOCTYPE html>

<meta charset="UTF-8">

<html>

<head>

  <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
  <script src="http://craig.is/assets/js/mousetrap/mousetrap.min.js"></script>

  <script>
    $(function () {
      /*global _, Mousetrap*/
      'use strict';
      $.getJSON('targets', function (targets) {
        _.each(_.keys(targets), function (name) {
          $('<button>' + name + '</button>').click(function () {
            $('#cmd').val(targets[name]);
            $('form').submit();
          }).appendTo('.targets');
        });
      });

      $('td > button').each(function (i, el) {
        var action = function () {
          send(el.id, 'control');
        };

        var stop = function () {
          send('stop', 'control');
        };

        $(el).mousedown(action).mouseup(stop);
        Mousetrap.bind(el.id === 'fire' ? 'space' : el.id, action, 'keydown');
        Mousetrap.bind(el.id === 'fire' ? 'space' : el.id, stop, 'keyup');
      });

      $('form').submit(function () {
        send($('#cmd').val(), 'execute');
        return false;
      });

      function send(cmd, url) {
        $.ajax({
          'type': 'POST',
          'url' : url,
          'data': {
            'cmd': cmd
          }
        });
      }
    });
  </script>
</head>

<body>
<h2>Launcher Control</h2>

<div class="targets">
</div>

<pre>
You can also use arrow keys to control and spacebar to fire
</pre>
<table>
  <tr>
    <td></td>
    <td>
      <button id="up">▲</button>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>
      <button id="left">◀</button>
    </td>
    <td>
      <button id="fire">◎</button>
    </td>
    <td>
      <button id="right">▶</button>
    </td>
  </tr>

  <tr>
    <td></td>
    <td>
      <button id="down">▼</button>
    </td>
    <td></td>
  </tr>
</table>

<form>
  <details>
    <summary>Control Instructions</summary>
    <pre>
Define launch sequences here up(u), down(d), left(l), right(r), fire(f), reset(z)
The numbers after u,d,l,r represents ms to do that action.
The number after f represents number of missiles to fire
e.g. this is a valid sequence:  d1000,l200,r,u100,f2
  </pre>
  </details>

  <input type="text" id="cmd"/>
  <input type="submit" value="Execute!"/>
</form>

</body>

</html>
